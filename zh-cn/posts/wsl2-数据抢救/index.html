<!DOCTYPE html>
<html class="no-js" lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>WSL2 数据抢救：从 `E_UNEXPECTED` 故障到文件修复 - Mingzf 的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/zh-cn" title="Mingzf 的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Mingzf 的博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/zh-cn/posts">
				
				<span class="menu__text">日志</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/zh-cn/about/about">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/zh-cn/about/my_cv">
				
				<span class="menu__text">简历</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/en">
				
				<span class="menu__text">English</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-26Y8LPEFKG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-26Y8LPEFKG');
    </script>
</header>

		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WSL2 数据抢救：从 `E_UNEXPECTED` 故障到文件修复</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2025-08-14T21:45:07&#43;08:00">August 14, 2025</time></div></div>
		</header>
		
<div class="post__toc toc">
	<div class="toc__title">目录</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#突发故障wsl2-无法启动">突发故障：WSL2 无法启动</a></li>
    <li><a href="#初步尝试备份与复制均失败">初步尝试：备份与复制均失败</a></li>
    <li><a href="#更换思路覆盖文件遇阻">更换思路：覆盖文件遇阻</a></li>
    <li><a href="#关键操作注销挂载与修复">关键操作：注销、挂载与修复</a>
      <ul>
        <li><a href="#注销发行版">注销发行版</a></li>
        <li><a href="#挂载损坏的虚拟磁盘">挂载损坏的虚拟磁盘</a></li>
        <li><a href="#确定挂载位置">确定挂载位置</a></li>
        <li><a href="#执行修复操作">执行修复操作</a></li>
      </ul>
    </li>
    <li><a href="#最终恢复覆盖文件成功">最终恢复：覆盖文件成功</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<h2 id="突发故障wsl2-无法启动">突发故障：WSL2 无法启动</h2>
<p>毫无征兆地，WSL2 突然罢工。启动时，终端直接抛出 <code>灾难性故障 wsl/service/E_unexpected</code> 的错误信息，Ubuntu-20.04 发行版彻底无法访问。这让我心头一紧，里面存储着不少重要的代码和数据。</p>
<h2 id="初步尝试备份与复制均失败">初步尝试：备份与复制均失败</h2>
<p>遇到这种情况，第一反应是赶紧备份数据。尝试使用 <code>wsl --export</code> 命令将发行版导出为 <code>tar</code> 格式的备份文件，可系统根本不响应，导出操作完全无法进行。</p>
<p>既然导出不行，想到了 WSL2 的核心存储文件 <code>ext4.vhdx</code>。找到这个文件的位置后，试图通过直接迁移、复制的方式进行数据抢救，但尝试了几次，复制过程都不顺利，显然这种方式也走不通。</p>
<h2 id="更换思路覆盖文件遇阻">更换思路：覆盖文件遇阻</h2>
<p>换了个思路，先在 WSL2 中安装相同版本的 <code>Ubuntu-20.04</code> 发行版。安装完成后，执行 <code>wsl --shutdown</code> 命令关闭所有 WSL 进程，然后在 Windows 系统下，将之前有问题的 <code>ext4.vhdx</code> 文件覆盖到新安装发行版的对应目录下。</p>
<p>然而，这次尝试还是失败了。新安装的发行版依旧无法正常启动，推测这是因为 <code>ext4.vhdx</code> 文件内部已经损坏，单纯的覆盖解决不了问题。</p>
<h2 id="关键操作注销挂载与修复">关键操作：注销、挂载与修复</h2>
<h3 id="注销发行版">注销发行版</h3>
<p>既然覆盖不行，决定先注销掉这个有问题的发行版，执行命令：</p>
<pre tabindex="0"><code>wsl --unregister Ubuntu-20.04
</code></pre><h3 id="挂载损坏的虚拟磁盘">挂载损坏的虚拟磁盘</h3>
<p>接下来，需要挂载那个损坏的 ext4.vhdx 文件来进行修复。在管理员权限的 PowerShell 中执行挂载命令：</p>
<pre tabindex="0"><code>wsl.exe --mount &lt;path-to-ext4.vhdx&gt; --vhd --bare
</code></pre><p>这里的 <code>&lt;path-to-ext4.vhdx&gt;</code> 需要替换为 <code>ext4.vhdx</code> 文件的实际路径，<code>--bare</code> 参数能保证只挂载不自动分配盘符。</p>
<h3 id="确定挂载位置">确定挂载位置</h3>
<p>挂载完成后，执行 <code>wsl.exe lsblk</code> 命令查看具体的装载位置，通过输出信息，确定了损坏的虚拟磁盘被挂载到了 <code>/dev/sdd</code>。</p>
<h3 id="执行修复操作">执行修复操作</h3>
<p>知道了挂载位置，就可以进行修复了。在 WSL 终端中执行以下命令：</p>
<pre tabindex="0"><code>sudo e2fsck -f /dev/sdd
</code></pre><p><code>e2fsck</code> 是专门用于修复 ext 系列文件系统的工具，<code>-f</code> 参数表示强制检查，即使系统认为文件系统正常。</p>
<h2 id="最终恢复覆盖文件成功">最终恢复：覆盖文件成功</h2>
<p>修复完成后，再次安装相同版本的 Ubuntu-20.04 发行版，执行 <code>wsl --shutdown</code> 关闭 WSL 进程，然后将修复好的 <code>ext4.vhdx</code> 文件覆盖到新安装发行版的目录下。</p>
<p>这次，当重新启动 WSL2 时，系统成功启动，里面的数据也完好无损，数据抢救工作终于完成。</p>
<h2 id="总结">总结</h2>
<p>这次 WSL2 数据抢救经历表明，当遇到 <code>灾难性故障 wsl/service/E_unexpected</code> 时，不要急于重新安装系统。可以通过注销发行版、挂载损坏的虚拟磁盘、使用 e2fsck 工具进行修复等步骤，尝试挽救里面的数据。当然，日常做好数据备份，才是避免数据丢失的最佳方式。</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/zh-cn/tags/wsl2%E6%95%85%E9%9A%9C%E4%BF%AE%E5%A4%8D/" rel="tag">WSL2故障修复</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/zh-cn/tags/code/" rel="tag">code</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/zh-cn/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/zh-cn/tags/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/" rel="tag">数据恢复</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>







<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
  new Valine({
      el: '#vcomments' ,
      appId: '6K1b7yCAWBISieeYhYiYm52A-gzGzoHsz',
      appKey: 'Xzo9x3Euwd2redfSk9bHafaB',
      notify: 'false', 
      verify: 'false', 
      avatar:'mm', 
      placeholder: '说点什么吧...',
      visitor: 'true'
  });
</script>

			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 HUA Guangbin.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
            </div>
            <div style="font-size: 10px"><a href="http://beian.miit.gov.cn" target="_blank" >苏ICP备2022045537号</a>
</div>   
		</div>
	</div>
<footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>
